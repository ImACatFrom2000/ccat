<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="style.css">
        <title>ゲーム</title>
    </head>
    <body>
        <main>
            <div class="playArea">
                <div id="lane1" class="lane"><img src="fruit_apple.png"></div>
                <div id="lane2" class="lane"><img src="fruit_apple.png"></div>
                <div id="lane3" class="lane"><img src="fruit_apple.png"></div>
                <div id="lane4" class="lane"><img src="fruit_apple.png"></div>
                <div id="lane5" class="lane"><img src="fruit_apple.png"></div>
                <div id="player"></div>
            </div>
        </main>
        <script src="../scripts/jquery-3.7.1.min.js"></script>
        <script>
            'use strict';

            $(document).ready(function(){
                console.log('READY');
                let playerX = 0;
                const playerY = 450;
                
                fallFruits();
                setInterval(fallFruits, 2000);

                //540px(画面の高さ+りんご)を2000ミリ秒で落ちる。10秒ごとに実行
                //540*(10/2000)=2.7px/10ms

                function fallFruits(){
                    const num = Math.floor(Math.random()*5)+1;
                    const fruitsX = 200 * (num-1) + 80;
                    $(`#lane${num} img`).addClass('falling');
                    let count=0;
                    const maxCount = 200;
                    const intervalTime = 10;

                    const intervalId = setInterval(() => {
                        let fruitsY= falling(count);
                        count++;

                        if (count >= maxCount) {
                            clearInterval(intervalId);
                            $('.falling').attr('style', ``);
                            $(`#lane${num} img`).removeClass('falling');
                        }
                    }, intervalTime);
                }

                function falling(i){
                    $('.falling').attr('style', `top: ${2.7*i-40}px`);
                    return 2.7*i-40;
                }

                $(document).keydown(function(e){
                    switch (e.keyCode){
                        case 65:            //A(左)
                            keydownLeft();
                            break;
                        case 68:            //D(右)
                            keydownRight();
                            break;
                        default:        
                            break;
                    }
                    $('#player').attr('style', `left: ${playerX*10}px;`);
                })
                function keydownLeft(){
                    if(playerX>0){
                        playerX--;
                    }
                }
                function keydownRight(){
                    if(playerX<95){
                        playerX++;
                    }
                }
            })
        </script>
    </body>
</html>